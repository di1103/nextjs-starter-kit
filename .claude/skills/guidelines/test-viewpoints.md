# テスト観点リスト（Webアプリ版）

設計書作成時にこのリストから該当する観点を選択し、テスト作成時の指針とする。

---

## 使い方

1. 設計書作成時に該当する観点を選択
2. 設計書の「テスト観点」セクションに記載
3. 実装時に各観点に対応するテストを作成
4. 全観点にテストがあることを確認

---

## 1. 機能

### 1-1 基本機能

| ID | 観点 | 確認内容 | テスト種別 |
|----|------|---------|-----------|
| F-1-1 | 画面表示 | 画面が正しく表示されるか | Unit/E2E |
| F-1-2 | フォーム送信 | データが正しく送信・保存されるか | Unit/E2E |
| F-1-3 | データ取得 | 一覧・詳細が正しく取得されるか | Unit |
| F-1-4 | 更新処理 | データが正しく更新されるか | Unit |
| F-1-5 | 削除処理 | データが正しく削除されるか | Unit |

### 1-2 入力検証

| ID | 観点 | 確認内容 | テスト種別 |
|----|------|---------|-----------|
| F-2-1 | 必須チェック | 必須項目が空の場合エラーになるか | Unit |
| F-2-2 | 型チェック | 不正な型（文字→数値等）でエラーになるか | Unit |
| F-2-3 | 最大長 | 最大長を超えた場合エラーになるか | Unit |
| F-2-4 | 最小値・最大値 | 範囲外の値でエラーになるか | Unit |
| F-2-5 | 境界値 | 境界値（0、最大、最小）で正しく動作するか | Unit |
| F-2-6 | 形式チェック | メール、URL等の形式が正しく検証されるか | Unit |

### 1-3 データ処理

| ID | 観点 | 確認内容 | テスト種別 |
|----|------|---------|-----------|
| F-3-1 | 0件処理 | データが0件の場合、適切に表示されるか | Unit/E2E |
| F-3-2 | 大量データ | 大量データでも正しく処理されるか | Unit |
| F-3-3 | ページネーション | ページ切り替えが正しく動作するか | Unit/E2E |
| F-3-4 | ソート | ソートが正しく動作するか | Unit |
| F-3-5 | フィルタ | フィルタが正しく動作するか | Unit |

### 1-4 画面遷移

| ID | 観点 | 確認内容 | テスト種別 |
|----|------|---------|-----------|
| F-4-1 | 正常遷移 | 期待通りの画面に遷移するか | E2E |
| F-4-2 | 戻る操作 | ブラウザバックで正しく動作するか | E2E |
| F-4-3 | 直接アクセス | URLへの直接アクセスで正しく動作するか | E2E |
| F-4-4 | リダイレクト | 条件に応じて正しくリダイレクトされるか | E2E |

### 1-5 エラーハンドリング

| ID | 観点 | 確認内容 | テスト種別 |
|----|------|---------|-----------|
| F-5-1 | バリデーションエラー | エラーメッセージが適切に表示されるか | Unit/E2E |
| F-5-2 | サーバーエラー | 500エラー時に適切に処理されるか | Unit |
| F-5-3 | ネットワークエラー | 通信失敗時に適切に処理されるか | E2E |
| F-5-4 | 404エラー | 存在しないリソースへのアクセス時の処理 | E2E |

---

## 2. セキュリティ

### 2-1 認証

| ID | 観点 | 確認内容 | テスト種別 |
|----|------|---------|-----------|
| S-1-1 | ログイン成功 | 正しい認証情報でログインできるか | E2E |
| S-1-2 | ログイン失敗 | 不正な認証情報で拒否されるか | E2E |
| S-1-3 | ログアウト | セッションが正しく破棄されるか | E2E |
| S-1-4 | セッション有効期限 | 期限切れ時に再認証を求めるか | E2E |

### 2-2 認可

| ID | 観点 | 確認内容 | テスト種別 |
|----|------|---------|-----------|
| S-2-1 | 未認証アクセス | 未ログインで保護ページにアクセス時リダイレクトされるか | Unit/E2E |
| S-2-2 | 権限不足 | 権限のない操作が拒否されるか | Unit |
| S-2-3 | 管理者機能 | 管理者のみ操作できる機能が制限されているか | Unit/E2E |
| S-2-4 | 他ユーザーデータ | 他ユーザーのデータにアクセスできないか | Unit |

### 2-3 入力セキュリティ

| ID | 観点 | 確認内容 | テスト種別 |
|----|------|---------|-----------|
| S-3-1 | XSS対策 | スクリプトが実行されないか | Unit |
| S-3-2 | SQLインジェクション | 不正なSQLが実行されないか | Unit |
| S-3-3 | CSRF対策 | 不正なリクエストが拒否されるか | Unit |

---

## 3. 性能

### 3-1 レスポンス

| ID | 観点 | 確認内容 | テスト種別 |
|----|------|---------|-----------|
| P-1-1 | 初期表示 | 画面の初期表示が3秒以内か | E2E |
| P-1-2 | 操作レスポンス | ボタン押下後の反応が1秒以内か | E2E |
| P-1-3 | 一覧表示 | 100件以上のデータ表示が問題ないか | E2E |

### 3-2 負荷

| ID | 観点 | 確認内容 | テスト種別 |
|----|------|---------|-----------|
| P-2-1 | 同時アクセス | 複数ユーザー同時アクセスで問題ないか | E2E |
| P-2-2 | 連続操作 | 連続した操作で問題ないか | E2E |

---

## 4. ユーザビリティ

### 4-1 操作性

| ID | 観点 | 確認内容 | テスト種別 |
|----|------|---------|-----------|
| U-1-1 | タップターゲット | ボタン・リンクが44px以上か | Unit/E2E |
| U-1-2 | 入力フィールド | 入力欄が適切なサイズか | Unit |
| U-1-3 | キーボード操作 | Tab、Enterで操作できるか | E2E |
| U-1-4 | フォーカス | フォーカスが視認できるか | E2E |

### 4-2 フィードバック

| ID | 観点 | 確認内容 | テスト種別 |
|----|------|---------|-----------|
| U-2-1 | ローディング表示 | 処理中であることが分かるか | Unit/E2E |
| U-2-2 | 成功メッセージ | 処理成功が分かるか | E2E |
| U-2-3 | エラーメッセージ | エラー内容と対処法が分かるか | Unit/E2E |
| U-2-4 | 確認ダイアログ | 重要な操作前に確認があるか | E2E |

### 4-3 画面構成

| ID | 観点 | 確認内容 | テスト種別 |
|----|------|---------|-----------|
| U-3-1 | レスポンシブ | モバイル・デスクトップで適切に表示されるか | E2E |
| U-3-2 | スクロール | 重要な操作がスクロールで隠れていないか | E2E |
| U-3-3 | 現在位置 | 今どの画面にいるか分かるか | E2E |

### 4-4 エラー防止

| ID | 観点 | 確認内容 | テスト種別 |
|----|------|---------|-----------|
| U-4-1 | 入力ヒント | 入力形式のヒントがあるか | Unit |
| U-4-2 | 未保存警告 | 未保存データがある場合に警告されるか | E2E |
| U-4-3 | 操作の取り消し | 誤操作を取り消せるか | E2E |
| U-4-4 | 削除確認 | 削除前に確認ダイアログがあるか | E2E |

---

## 観点の選択ガイド

### 機能タイプ別の必須観点

#### CRUD機能

```
必須:
- F-1-1 ~ F-1-5（基本機能）
- F-2-1 ~ F-2-5（入力検証）
- F-3-1（0件処理）
- F-5-1（バリデーションエラー）
- S-2-1 ~ S-2-2（認可）
```

#### 認証機能

```
必須:
- S-1-1 ~ S-1-4（認証）
- S-2-1 ~ S-2-3（認可）
- F-5-1（バリデーションエラー）
```

#### 一覧・検索機能

```
必須:
- F-1-3（データ取得）
- F-3-1 ~ F-3-5（データ処理）
- P-1-3（一覧表示性能）
```

#### フォーム機能

```
必須:
- F-1-2（フォーム送信）
- F-2-1 ~ F-2-6（入力検証）
- F-5-1（バリデーションエラー）
- U-2-1 ~ U-2-3（フィードバック）
- U-4-1 ~ U-4-2（エラー防止）
```

---

## テストコード例

### バリデーション（F-2系）

```typescript
// lib/validations/product.test.ts
import { describe, it, expect } from 'vitest';
import { productSchema } from './product';

describe('productSchema', () => {
  // F-2-1: 必須チェック
  it('名前が空の場合エラー', () => {
    const result = productSchema.safeParse({ name: '', price: 1000 });
    expect(result.success).toBe(false);
  });

  // F-2-4: 最小値・最大値
  it('価格が負の場合エラー', () => {
    const result = productSchema.safeParse({ name: '商品', price: -1 });
    expect(result.success).toBe(false);
  });

  // F-2-5: 境界値
  it('価格が0は許可', () => {
    const result = productSchema.safeParse({ name: '商品', price: 0 });
    expect(result.success).toBe(true);
  });
});
```

### 認可（S-2系）

```typescript
// lib/actions/product.test.ts
import { describe, it, expect, vi } from 'vitest';
import { createProduct } from './product';

// S-2-1: 未認証アクセス
describe('createProduct', () => {
  it('未認証の場合エラー', async () => {
    vi.mocked(requireAuth).mockRejectedValue(new Error('Unauthorized'));

    await expect(createProduct({ name: '商品', price: 1000 }))
      .rejects.toThrow('Unauthorized');
  });
});
```

### モバイル操作性（U-1系）

```typescript
// e2e/mobile.spec.ts
import { test, expect, devices } from '@playwright/test';

test.use(devices['iPhone 14']);

// U-1-1: タップターゲット
test('ボタンが44px以上', async ({ page }) => {
  await page.goto('/products');

  const buttons = page.locator('button');
  for (const button of await buttons.all()) {
    const box = await button.boundingBox();
    expect(box?.height).toBeGreaterThanOrEqual(44);
  }
});
```
