# 設計書作成スキル

このスキルは、顧客情報から設計書を作成するためのガイドラインです。

---

## 実行フロー

### Phase 0: 情報源の確認

**タイミング**: スキル実行開始時

```
docs/customer/ に顧客情報があるか確認
├── あり → Phase 1 へ
└── なし → Phase 0-B（直接ヒアリング）へ
```

#### Phase 0-B: 直接ヒアリング（顧客情報がない場合）

顧客情報がない場合、ユーザーに直接要件をヒアリングする。

**確認項目**:

| カテゴリ | 質問例 |
|---------|--------|
| 目的 | この機能で何を実現したいですか？ |
| ユーザー | 誰が使いますか？（管理者/一般ユーザー/両方） |
| 操作 | どのような操作が必要ですか？（作成/表示/編集/削除） |
| データ | どのようなデータを扱いますか？（項目名、型、制約） |
| 画面 | 画面イメージはありますか？（あれば共有依頼） |
| 制約 | 特別な制約や注意点はありますか？ |

**出力**: ヒアリング結果を要件としてまとめ、Phase 2 へ

---

### Phase 1: 顧客情報の探索（Subagent: Explore）

**タイミング**: ユーザーから要件定義駆動開発の指示を受けたら最初に実行

```
Task(subagent_type="Explore")
├── docs/customer/requirements/ を探索
│   └── 検索キーワード: 機能名、画面名、業務用語
├── docs/customer/meeting-notes/ を探索
│   └── 検索キーワード: 決定事項、TODO、要件変更
└── 関連する要件・決定事項を抽出
    └── 優先度、期限、制約条件も含める
```

**探索のポイント**:
- 機能名・画面名で直接検索
- 業務用語（例: 「注文」「在庫」「承認」）で検索
- 関連機能への言及も確認
- 制約条件（期限、予算、技術的制約）を抽出

**出力**: 要件の要約リスト

---

### Phase 2: 設計方針の計画（Subagent: Plan）

**タイミング**: Phase 1 完了後

```
Task(subagent_type="Plan")
├── 機能の分割方針を決定
├── 依存関係を整理
├── 実装ファイル構成を計画
└── 設計書の構成を決定
```

**出力**: 設計書の目次・構成案

---

### Phase 3: 設計書の生成

**タイミング**: Phase 2 完了後、ユーザー確認を経て実行

1. `docs/design/index.md` を更新（機能一覧に追加）
2. `docs/design/features/[機能名].md` を作成
3. `docs/design/ui/[画面名].md` を作成（UI設計がある場合）

---

## 設計書フォーマット

### 機能設計書 (`docs/design/features/[機能名].md`)

```markdown
# [機能名]

## 更新履歴

| 日付 | 変更内容 | 担当 |
|------|---------|------|
| YYYY-MM-DD | 初版作成 | Claude |

## 概要
[この機能の目的・背景]

## 要件
- [ ] 要件1
- [ ] 要件2
- [ ] 要件3

## 依存関係

### 前提機能（この機能が依存する）
| 機能 | 設計書 | 必要な理由 |
|------|--------|-----------|
| 認証 | [auth.md](./auth.md) | ログイン済みユーザーが前提 |
| - | - | 依存なしの場合は「なし」と記載 |

### 被依存機能（この機能に依存する）
| 機能 | 設計書 | 依存内容 |
|------|--------|---------|
| 注文 | [order.md](./order.md) | 商品情報を参照 |
| - | - | 被依存なしの場合は「なし」と記載 |

## 画面・UI
[関連するUI設計書へのリンク、またはなしの場合は「なし」]

## データベース設計

### テーブル
| テーブル名 | 説明 |
|-----------|------|
| xxx | ... |

### スキーマ定義
```typescript
// lib/db/schemas/xxx.ts
export const xxx = pgTable("xxx", {
  // フィールド定義
});
```

## API / Server Actions

### [アクション名]
- **ファイル**: `lib/actions/xxx.ts`
- **引数**: `{ field1: string, field2: number }`
- **戻り値**: `{ success: boolean, data?: T }`
- **権限**: admin / user / public

## バリデーション
```typescript
// lib/validations/xxx.ts
export const xxxSchema = z.object({
  // スキーマ定義
});
```

## 実装チェックリスト
- [ ] DBスキーマ作成
- [ ] Server Actions作成
- [ ] バリデーション作成
- [ ] UI実装
- [ ] 動作確認

## テスト観点

`.claude/skills/guidelines/test-viewpoints.md` から該当する観点を選択。

### 選択した観点

| ID | 観点 | テスト種別 | 優先度 |
|----|------|-----------|--------|
| F-1-2 | フォーム送信 | Unit/E2E | 必須 |
| F-2-1 | 必須チェック | Unit | 必須 |
| F-2-5 | 境界値 | Unit | 必須 |
| S-2-1 | 未認証アクセス | Unit | 必須 |
| U-2-1 | ローディング表示 | Unit | 推奨 |

### 正常系
- [ ] F-1-2: データが正しく保存されるか
- [ ] ...

### 異常系
- [ ] F-2-1: 必須項目が空の場合エラーになるか
- [ ] S-2-1: 未認証でアクセス時リダイレクトされるか
- [ ] ...

## 備考
[実装時の注意点、既知の制約など]
```

---

### UI設計書 (`docs/design/ui/[画面名].md`)

#### 粒度の判断基準

| 条件 | 粒度 | 例 |
|------|------|-----|
| 独立したURL（ルート）を持つ | 個別の設計書 | `/products`, `/users` |
| モーダル・ドロワー・ダイアログ | 親画面の設計書に含める | 「商品編集モーダル」→ 商品一覧.md |
| 複数画面で共有するコンポーネント | 別途コンポーネント設計書 | ヘッダー、サイドバー |
| 同一機能の一覧・詳細・編集 | 機能単位で1設計書 | 商品一覧+詳細+編集 → 商品画面.md |

```markdown
# [画面名]

## 更新履歴

| 日付 | 変更内容 | 担当 |
|------|---------|------|
| YYYY-MM-DD | 初版作成 | Claude |

## 概要
[この画面の目的]

## アクセス権限
- admin: ✅
- user: ✅ / ❌
- 未ログイン: ❌

## ワイヤーフレーム
```
┌─────────────────────────────────┐
│  ヘッダー                        │
├─────────────────────────────────┤
│                                 │
│  コンテンツエリア                 │
│                                 │
└─────────────────────────────────┘
```

## コンポーネント構成
- `app/components/Xxx.tsx` - メインコンポーネント
- `app/components/XxxItem.tsx` - 子コンポーネント

## 使用するUIコンポーネント（shadcn/ui）
- Button
- Card
- Dialog
- ...

## 状態管理
[useState / useReducer / 外部ライブラリ]

## データ取得
[Server Component / useEffect / Server Actions]

## 実装チェックリスト
- [ ] コンポーネント作成
- [ ] レスポンシブ対応
- [ ] ローディング状態
- [ ] エラー状態
- [ ] 動作確認

## テスト観点

`.claude/skills/guidelines/test-viewpoints.md` から該当する観点を選択。

### 選択した観点

| ID | 観点 | テスト種別 | 優先度 |
|----|------|-----------|--------|
| F-4-1 | 正常遷移 | E2E | 必須 |
| U-1-1 | タップターゲット | Unit/E2E | 必須 |
| U-2-1 | ローディング表示 | Unit | 必須 |
| U-2-3 | エラーメッセージ | Unit/E2E | 必須 |
| U-3-1 | レスポンシブ | E2E | 必須 |

### 確認項目
- [ ] U-1-1: ボタン・リンクが44px以上か
- [ ] U-2-1: 処理中であることが分かるか
- [ ] U-3-1: モバイル・デスクトップで適切に表示されるか
- [ ] ...
```

---

## 注意点

### Claude Code用の最適化

1. **1ファイル = 1機能**: 設計書は機能ごとに分割し、Claude Codeが一度に処理できるサイズに
2. **具体的なファイルパス**: 実装先のファイルパスを明記
3. **型定義を含める**: TypeScriptの型・スキーマを設計書に記載
4. **チェックリスト形式**: 実装完了を追跡できる形式に

### 依存関係の明示

設計書には以下を必ず記載：
- 他の機能への依存
- 既存コードとの関係
- 実装順序の推奨

### 段階的な実装

複雑な機能は以下のように分割：
1. DBスキーマ → マイグレーション
2. Server Actions → ビジネスロジック
3. UI → ユーザーインターフェース
4. 結合テスト

---

## 実装スキルへの引き継ぎ

設計書完成後、実装フェーズへスムーズに移行するための手順。

### 設計完了時のチェックリスト

```
設計書完成時に以下を確認:
├── [ ] docs/design/index.md に追加済み
├── [ ] 状態が「設計完了」に更新済み
├── [ ] テスト観点が選択済み
├── [ ] 依存関係が明記済み
└── [ ] 実装チェックリストが記載済み
```

### 実装開始の指示例

設計書完了後、ユーザーに以下を案内:

```
設計書が完成しました。

📄 作成した設計書:
- docs/design/features/user-management.md
- docs/design/ui/user-list.md

実装を開始するには:
「user-management を実装して」
または
「実装フェーズを開始して」
と指示してください。
```

### 設計書パスの指定

実装スキルは以下の方法で設計書を特定:

1. **直接指定**: 「docs/design/features/xxx.md を実装して」
2. **機能名指定**: 「ユーザー管理を実装して」→ index.md から検索
3. **全体実行**: 「実装フェーズを開始して」→ 状態が「設計完了」の全設計書

---

## 使用例

### 例1: 顧客情報がある場合

```
ユーザー: 「ユーザー管理機能の設計書を作成して」

Claude:
1. [Phase 0] docs/customer/ に情報があることを確認
2. [Phase 1: Explore] 要件を探索・抽出
3. [Phase 2: Plan] 機能構成・依存関係を計画
4. ユーザーに確認「この構成でよいですか？」
5. 承認後、設計書を生成
   - docs/design/index.md を更新
   - docs/design/features/user-management.md を作成
   - docs/design/ui/user-list.md を作成
6. 実装開始の案内を表示
```

### 例2: 顧客情報がない場合

```
ユーザー: 「商品管理機能の設計書を作成して」

Claude:
1. [Phase 0] docs/customer/ が空であることを確認
2. [Phase 0-B] ユーザーにヒアリング
   - 「商品管理でどのような操作が必要ですか？」
   - 「商品にはどのような項目がありますか？」
   - 「誰が操作しますか？」
3. ヒアリング結果を要件として整理
4. [Phase 2: Plan] 機能構成を計画
5. 以降同様
```
