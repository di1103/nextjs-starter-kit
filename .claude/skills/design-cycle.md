# 要件定義駆動開発スキル

顧客要件から**全ての設計書を一気に作成**するスキルです。

---

## 実行タイミング

ユーザーから以下のような指示を受けたとき:
- 「要件定義駆動開発を開始して」
- 「全設計書を作成して」
- 「設計を完走して」

---

## 全体フロー

```
┌─────────────────────────────────────────────────────────────┐
│  Phase 1: 顧客情報探索 (Explore)                             │
│  └── docs/customer/* から要件を抽出                          │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│  Phase 2: 設計計画 (Plan)                                    │
│  ├── 要件をID採番・構造化                                    │
│  ├── 設計書一覧を決定                                        │
│  └── 進捗ファイルを生成                                      │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│  Phase 3: 設計書一括作成                                     │
│  ├── design-docs-list の順に全設計書を作成                   │
│  ├── 1件作成ごとに進捗ファイルを更新                         │
│  └── 全件完了まで繰り返し                                    │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│  Phase 4: 完了検証                                           │
│  ├── 要件カバー率 100% を確認                                │
│  ├── トレーサビリティ検証                                    │
│  └── 完了レポート生成                                        │
└─────────────────────────────────────────────────────────────┘
```

---

## Phase 1: 顧客情報探索

```
Task(subagent_type="Explore")
├── docs/customer/requirements/ の全ファイルを探索
├── docs/customer/meeting-notes/ の全ファイルを探索
├── docs/customer/estimates/ の関連情報を探索
└── 要件・決定事項・制約を抽出
```

**出力**: 顧客情報の要約リスト

---

## Phase 2: 設計計画

```
Task(subagent_type="Plan")
├── 要件をID採番（REQ-XXX-NNN形式）
│   - FUN: 機能要件
│   - UI: UI要件
│   - SEC: セキュリティ要件
│   - PER: 性能要件
├── 設計書一覧を決定（DOC-XXX-NNN形式）
├── 要件と設計書の紐付け
└── 作成順序を決定（依存関係考慮）
```

**生成ファイル**:
- `docs/progress/requirements-list.md`
- `docs/progress/design-docs-list.md`
- `docs/progress/traceability-matrix.md`
- `docs/progress/cycle-status.md`

---

## Phase 3: 設計書一括作成

**design-docs-list.md に記載された全設計書を順に作成**

各設計書の作成手順:

### 3.1 機能設計書 (docs/design/features/xxx.md)

```markdown
# [機能名]

## 概要
[この機能の目的・背景]

## 要件
- [ ] REQ-XXX-001: 要件1
- [ ] REQ-XXX-002: 要件2

## データベース設計

### テーブル
| テーブル名 | 説明 |
|-----------|------|
| xxx | ... |

### スキーマ定義
```typescript
// lib/db/schemas/xxx.ts
export const xxx = pgTable("xxx", {
  // フィールド定義
});
```

## API / Server Actions

### [アクション名]
- **ファイル**: `lib/actions/xxx.ts`
- **引数**: `{ field1: string }`
- **戻り値**: `{ success: boolean, data?: T }`
- **権限**: admin / user / public

## バリデーション
```typescript
// lib/validations/xxx.ts
export const xxxSchema = z.object({
  // スキーマ定義
});
```

## 実装チェックリスト
- [ ] DBスキーマ作成
- [ ] Server Actions作成
- [ ] バリデーション作成
- [ ] UI実装
- [ ] 動作確認

## テスト観点
### 正常系
- ...
### 異常系
- ...

## 備考
[実装時の注意点]
```

### 3.2 UI設計書 (docs/design/ui/xxx.md)

```markdown
# [画面名]

## 概要
[この画面の目的]

## アクセス権限
- admin: ✅
- user: ✅ / ❌
- 未ログイン: ❌

## ワイヤーフレーム
```
┌─────────────────────────────────┐
│  ヘッダー                        │
├─────────────────────────────────┤
│                                 │
│  コンテンツエリア                 │
│                                 │
└─────────────────────────────────┘
```

## コンポーネント構成
- `app/components/Xxx.tsx` - メインコンポーネント
- `app/components/XxxItem.tsx` - 子コンポーネント

## 使用するUIコンポーネント（shadcn/ui）
- Button
- Card
- Dialog

## 状態管理
[useState / useReducer / 外部ライブラリ]

## データ取得
[Server Component / useEffect / Server Actions]

## 実装チェックリスト
- [ ] コンポーネント作成
- [ ] レスポンシブ対応
- [ ] ローディング状態
- [ ] エラー状態
- [ ] 動作確認
```

### 3.3 作成後の更新

各設計書作成後:
1. `design-docs-list.md` の状態を「完了」に更新
2. `traceability-matrix.md` のカバー状態を「✅」に更新
3. `cycle-status.md` の進捗を更新
4. `docs/design/index.md` に設計書を追加

---

## Phase 4: 完了検証

### 完了条件チェック

| 条件 | 基準 |
|------|------|
| 要件カバー率 | 100% |
| 設計書完了率 | 100% |
| トレーサビリティ | 孤児なし |

### 完了レポート出力

```markdown
## 要件定義駆動開発 完了レポート

### サマリー
- 要件数: XX件
- 設計書数: XX件
- 要件カバー率: 100%

### 作成された設計書

#### 機能設計書
| 設計書 | ファイル | カバー要件 |
|--------|----------|-----------|
| ... | features/xxx.md | REQ-XXX-001 |

#### UI設計書
| 設計書 | ファイル | カバー要件 |
|--------|----------|-----------|
| ... | ui/xxx.md | REQ-UI-001 |

### 次のステップ
→ 設計書の「実装チェックリスト」に従って実装を開始
```

---

## 進捗ファイルフォーマット

### requirements-list.md

```markdown
# 要件一覧

最終更新: YYYY-MM-DD HH:MM

## 機能要件 (FUN)

| 要件ID | 要件名 | 詳細 | 出典 | 優先度 | 状態 |
|--------|--------|------|------|--------|------|
| REQ-FUN-001 | ... | ... | requirements/xxx.md#L10 | 高 | 設計完了 |
```

### design-docs-list.md

```markdown
# 設計書一覧

最終更新: YYYY-MM-DD HH:MM

## 統計
- 完了: X / Y (100%)

## 機能設計書

| 設計書ID | 設計書名 | ファイル | 状態 | カバー要件 |
|----------|----------|----------|------|-----------|
| DOC-FUN-001 | ... | features/xxx.md | 完了 | REQ-FUN-001 |
```

### traceability-matrix.md

```markdown
# トレーサビリティマトリクス

最終更新: YYYY-MM-DD HH:MM

## カバレッジ: XX/XX (100%)

| 要件ID | 要件名 | 設計書 | 状態 |
|--------|--------|--------|------|
| REQ-FUN-001 | ... | DOC-FUN-001 | ✅ 完全 |
```

### cycle-status.md

```markdown
# サイクル状態

最終更新: YYYY-MM-DD HH:MM

## 現在のフェーズ
**完了** ✅

## 進捗
- [x] 要件抽出完了
- [x] 設計書一覧確定
- [x] 設計書作成 (X/X 完了)
- [x] トレーサビリティ検証
- [x] 完了レビュー

## 品質指標
- 要件カバー率: 100%
- 設計書完了率: 100%
```

---

## 注意事項

### Claude Code用の最適化
1. **1ファイル = 1機能**: 設計書は機能ごとに分割
2. **具体的なファイルパス**: 実装先のファイルパスを明記
3. **型定義を含める**: TypeScriptの型・スキーマを設計書に記載
4. **チェックリスト形式**: 実装完了を追跡できる形式

### 依存関係の明示
- 他の機能への依存を設計書に記載
- 既存コードとの関係を明記
- 実装順序の推奨を含める

### 段階的な実装への引き継ぎ
1. DBスキーマ → マイグレーション
2. Server Actions → ビジネスロジック
3. UI → ユーザーインターフェース
4. 結合テスト
